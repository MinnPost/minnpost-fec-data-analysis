<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>MN FEC Q1</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="shortcut icon" href="http://www.minnpost.com/sites/default/themes/siteskin/favicon.ico" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>

  <!-- Add in CSS from the site, as it is cached, it can change -->
  
  <link type="text/css" rel="stylesheet" media="all" href="http://www.minnpost.com/sites/default/files/css/css_797d2de1e2575237a18957e389160dc2.css" />
  <link type="text/css" rel="stylesheet" media="print" href="http://www.minnpost.com/sites/default/files/css/css_503415ad911b112c9df5167ff19cc90f.css" />
  <link type="text/css" rel="stylesheet" media="screen" href="http://www.minnpost.com/sites/default/files/css/css_2dd38cd622df5d453116df8a12f86174.css" /> 
  <!--[if IE]>
    <link rel="stylesheet" href="http://www.minnpost.com/sites/default/themes/derma/inc/css/ie.css?n" type="text/css">
  <![endif]-->
  
  <!-- Add in JS from the site, as it is cached, it can change -->
  
  <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script> 
  <script type="text/javascript" src="//s7.addthis.com/js/250/addthis_widget.js#async=1"></script> 
  <script type="text/javascript">
  /* <![CDATA[ */
  // Configuration
  var OAS_url = 'http://oascentral.minnpost.com/RealMedia/ads/';
  var OAS_sitepage = 'MP' + window.location.pathname;
  var OAS_listpos = 'TopLeft,Right1,TopRight,Top';
  var OAS_query = '';
  var OAS_target = '_top';
  
  var OAS_rns = (Math.random() + "").substring(2, 11);
  document.write('<scr' + 'ipt type="text/javascript" src="' + OAS_url + 'adstream_mjx.ads/' + OAS_sitepage + '/1' + OAS_rns + '@' + OAS_listpos + '?' + OAS_query + '">' + '<\/script>');
  
  function OAS_AD(pos) {
    if (typeof OAS_RICH != 'undefined') {
      OAS_RICH(pos);
    }
  }
  /* ]]> */
</script> 
  <script type="text/javascript">
  var _vrq = _vrq || [];
  _vrq.push(['id', 401]);
  _vrq.push(['automate', false]);
  _vrq.push(['track', function(){}]);
  (function(d, a){
    var s = d.createElement(a),
    x = d.getElementsByTagName(a)[0];
    s.async = true;
    s.src = 'http://a.visualrevenue.com/vrs.js';
    x.parentNode.insertBefore(s, x);
  })(document, 'script');
</script> 
  <script type="text/javascript" src="http://www.minnpost.com/sites/default/files/js/js_21d02f9d9421557c8bc6e797aed3b71f.js"></script>
  <script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","combineBlocks":[["#block-views-most_viewed_by_taxonomy-block","#block-views-most_commented_articles-block_1"],["#block-views-most_viewed_by_node_type-block","#block-views-most_commented_blogs-block_1"],["#block-views-most_viewed_by_node_type-block","#block-views-most_commented_articles-block_1"]],"chartbeat":{"uid":27923,"domain":"minnpost.com","title":"Data \u0026amp; Maps"},"googleanalytics":{"trackOutgoing":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip"},"addthis":{"config_default":{"services_toolbox":"facebook_like_counter, tweet, print, email","services_compact":"","services_expanded":"","ui_cobrand":"","ui_header_color":"#000000","ui_header_background":"#FFFFFF","ui_click":true,"ui_delay":"","ui_use_addressbook":0,"pubid":"xa-4e2cfd1147868c4e","data_track_clickback":0,"data_ga_tracker":0,"ui_use_css":true,"data_use_cookies":true,"ui_language":"en","data_use_flash":true},"share_default":{"templates":{"twitter":""}}}});
//--><!]]>
</script> 
  <script type="text/javascript">
<!--//--><![CDATA[//><!--
//--><!]]>
</script> 
  <script type="text/javascript">
<!--//--><![CDATA[//><!--
addthis_config = Drupal.settings.addthis.config_default; addthis_share = Drupal.settings.addthis.share_default;
//--><!]]>
</script> 
    
</head>
<body class="not-front logged-in page-node node-type-article one-sidebar sidebar-right section-data">


  <!-- Embed Start -->
  <div class="embeddable node-field-body">
    <style type="text/css">
    	@import url('//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.css');
    </style>
    <!--[if lte IE 8]><style type="text/css">
    	@import url('//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.ie.css');
    </style><![endif]-->
    <style type="text/css">
      .js-dependent,
      .hide {
        display: none;
      }
      .footnote {
        font-size: .75em;
        font-style: italic;
        color: #414141;
        margin-top: 1em;
        clear: both;
      }
      
      .map-wrapper {
        position: relative;
      }
        
      #dd-map {
        position: relative;
        width: 100%;
        height: 600px;
      }
      
      .metro-button {
        position: absolute;
        top: 80px;
        left: 15px;
        z-index: 20;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        width: 19px;
        height: 19px;
        background: #CCCCCC url('http://www.minnpost.com/sites/default/files/images/articles/icons/bigcity.png') 2px 0px no-repeat;
        background: rgba(255, 255, 255, 0.75) url('http://www.minnpost.com/sites/default/files/images/articles/icons/bigcity.png') 2px 0px no-repeat;
        cursor: pointer;
      }
      
      .wax-legend {
        position: absolute;
        bottom: 30px;
        right: 15px;
        z-index: 20;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        width: 140px;
        background-color: #222222;
        background-color: rgba(20, 20, 20, 0.7);
        color: #E2E2E2;
        padding-top: 10px;
        border: 1px solid #666666;
        border: 1px solid rgba(98, 98, 98, 0.7);
      }
      
      .wax-legend ul,
      .wax-legend ul li {
        list-style: none;
      }
      
      .tooltip {
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 20;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        min-width: 140px;
        min-height: 75px;
        background-color: #222222;
        background-color: rgba(20, 20, 20, 0.7);
        color: #E2E2E2;
        text-align: right;
        padding: 15px;
        border: 1px solid #666666;
        border: 1px solid rgba(98, 98, 98, 0.7);
      }
      .tooltip ul,
      .tooltip ul li {
        list-style: none;
      }
      
      .tooltip table {
        text-size: .75em;
      }
      .tooltip table tfoot th {
        border: none;
        border-top: 1px solid #222222;
        text-align: right;
        padding-right: .5em;
      }
      
      .locate-form {
        width: 330px;
        float: right;
        padding-bottom: 1em;
        text-align: right;
      }
      
      .loading-zips {
        position: absolute;
        top: 15px;
        left: 50px;
        z-index: 20;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        width: auto;
        height: auto;
        background-color: #CCCCCC;
        background-color: rgba(255, 255, 255, 0.55);
        padding: 3px 5px;
        font-size: .75em;
      }
    </style>
    
    <p class="js-dependent loading-zips">Loading ZIPs...</p>
    
    <div class="clear-block">
      <form class="js-dependent locate-form">
        <label for="geosearch">Search ZIP</label>
        <input id="geosearch" type="text" class="form-text" />
        <input type="submit" value="Go" class="form-submit" />
      </form>
    </div>
    
    <div class="map-wrapper">
  	  <div id="dd-map"></div>
    </div>
  	
  	<p class="footnote">Data from the <a href="http://www.fec.gov/">Federal Election Commission</a> and the <a href="http://www.census.gov/">US Census Bureau</a>.  Note that the ZIP code highlighting is approximate.</p>
  
    <script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/bubbletree-master-20120410/lib/jquery-1.5.2.min.js"><\/script>')</script>
    <script type="text/javascript" src="//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.js"></script>
    <script type="text/javascript">
      // Function to check for empty objects
      function isEmptyObject(obj) {
        for (var prop in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, prop)) {
            return false;
          }
        }
        return true;
      }
      // Currency percent
      function fPercent(num) {
        return (num * 100).toFixed(2) + '%';
      };
      // Currency function
      function fCurrency(num) {
        num = num.toString().replace(/\$|\,/g, '');
        if (isNaN(num)) num = "0";
        sign = (num == (num = Math.abs(num)));
        num = Math.floor(num * 100 + 0.50000000001);
        cents = num % 100;
        num = Math.floor(num / 100).toString();
        if (cents < 10) cents = "0" + cents;
        for (var i = 0; i < Math.floor((num.length - (1 + i)) / 3); i++)
          num = num.substring(0, num.length - (4 * i + 3)) + ',' + num.substring(num.length - (4 * i + 3));
        
        return (((sign) ? '' : '-') + '$' + num + '.' + cents);
      };
      function getTotal(data) {
        var total = 0;
        total += (data.obama_total) ? parseFloat(data.obama_total) : 0;
        total += (data.romney_total) ? parseFloat(data.romney_total) : 0;
        total += (data.santorum_total) ? parseFloat(data.santorum_total) : 0;
        total += (data.gingrich_total) ? parseFloat(data.gingrich_total) : 0;
        total += (data.paul_total) ? parseFloat(data.paul_total) : 0;
        return total;
      }
    
      // Format function
      tooltipFormat = function(data) {
        var output = '';
        var total = getTotal(data);

        output += '<h3>' + data.zip + '</h3>';
        
        if (total > 0) {
          output += '<table>';
          output += '<tfoot><tr><th>Total</th><th>' + fCurrency(total) + '</th><th></th></tr></tfoot>';
          
          output += '<tbody>';
          output += data.obama_total ? '<tr><td>Obama</td><td>' + fCurrency(data.obama_total) + 
            '</td><td>' + fPercent(parseFloat(data.obama_total) / total) + '</td></tr>' : '';
          output += data.romney_total ? '<tr><td>Romney</td><td>' + fCurrency(data.romney_total) + 
            '</td><td>' + fPercent(parseFloat(data.romney_total) / total) + '</td></tr>' : '';
          output += data.santorum_total ? '<tr><td>Santorum</td><td>' + fCurrency(data.santorum_total) + 
            '</td><td>' + fPercent(parseFloat(data.santorum_total) / total) + '</td></tr>' : '';
          output += data.gingrich_total ? '<tr><td>Gingrich</td><td>' + fCurrency(data.gingrich_total) + 
            '</td><td>' + fPercent(parseFloat(data.gingrich_total) / total) + '</td></tr>' : '';
          output += data.paul_total ? '<tr><td>Paul</td><td>' + fCurrency(data.paul_total) + 
            '</td><td>' + fPercent(parseFloat(data.paul_total) / total) + '</td></tr>' : '';
          output += '</tbody></table>';
        }
        
        return output;
      };
  		
      // Namespace jQuery
      (function($) {
    		$(document).ready(function() {
  		    var map = L.mapbox.map('dd-map', 'minnpost.map-4v6echxm,minnpost.fec-mn-2012-q1-dots', 
  		      { maxZoom: 13,minZoom: 2, scrollWheelZoom: false, gridControl: false });
  		    map.attributionControl.setPrefix('Map data &copy; OpenStreetMap contributors, CC-BY-SA, and the FEC; imagery by MapBox and MinnPost.');
  		    
      		// Add metro area button
      		$('<div></div>')
      		  .addClass('metro-button')
      		  .attr('title', 'Click to zoom to the Twin Cities metro area.')
      		  .click(function() {
      		    map.setView(new L.LatLng(44.88, -93.22), 9);
      		  })
      		  .appendTo($('#dd-map'));
      		
      		// Center map
          map.setView(new L.LatLng(46.1494, -93.4495), 6);
            
          // Show things
          $('.js-dependent').show();
            
          // Placeholders for zips
          var zipHighlight = {};
          var searchHighlight = {};
          var zipsIndexed = {};
          var highlightStyle = {
            stroke: true,
            color: '#BBBBBB',
            weight: 1,
            opacity: 0.5,
            fill: true,
            fillColor: '#CCCCCC',
            fillOpacity: 0.2,
            clickable: false
          };
          var searchStyle = {
            stroke: true,
            color: '#EEEEEE',
            weight: 4,
            opacity: 0.8,
            fill: true,
            fillColor: '#CCCCCC',
            fillOpacity: 0.2,
            clickable: false
          };
          
          // Handle search
          $('form.locate-form').submit(function(e) {
            e.preventDefault();
            var request = $('input#geosearch').val();
            if (!request) return;

            // Geocode with Mapquest
            $.getJSON('http://open.mapquestapi.com/nominatim/v1/search?format=json&json_callback=?&countrycodes=us&limit=1&q=' + encodeURI(request), function(value) {
              var mnBounds = new L.LatLngBounds(new L.LatLng(43.499356, -97.239209), new L.LatLng(49.384358, -89.489226));
              // Use first response
              value = value[0];
              
              // Check response
              if (value === undefined) {
                alert('We were unable turn your search terms, ' + request + ', into a geographical location.  Please be more specific, such as including ZIP code.');
              }
              // Check we are still mostly in Minnesota
              else if (!mnBounds.contains(new L.LatLng(value.lat, value.lon))) {
                alert('Sorry, but what you are looking for is outside of Minnesota.');
              }
              else {
                // Adjust zoom level based on geography
                if (value.type == 'state' || 
                    value.type == 'county' || 
                    value.type == 'maritime'  || 
                    value.type == 'country' ||
                    value.type == 'administrative') {
                  map.setView(new L.LatLng(value.lat, value.lon), 9);
                } else {
                  map.setView(new L.LatLng(value.lat, value.lon), 12);
                }
                
                // Highlight if zip
                if (!isEmptyObject(zipsIndexed) && typeof zipsIndexed[request] != 'undefined') {
                  // Highlight zip
                  map.removeLayer(searchHighlight);
                  searchHighlight = new L.GeoJSON();
                  searchHighlight.addData(zipsIndexed[request]);
                  searchHighlight.setStyle(searchStyle);
                  map.addLayer(searchHighlight);
                }
              }
            });
          });
    
    
          // Add custom interactivity
          map.gridLayer
            .on('mousemove', function(e) {
              var $tooltip = $('.tooltip');
              if ($tooltip.length  == 0) {
                $tooltip = $('<div></div>')
                  .addClass('tooltip')
                  .appendTo($('#dd-map'));
              }
              
              // Check if we should show
              if (typeof e.data != 'undefined' && typeof e.data.zip != 'undefined') {
                $tooltip.show().html(tooltipFormat(e.data));
                
                // Highlight zip
                if (!isEmptyObject(zipsIndexed)) {
                  map.removeLayer(zipHighlight);
                  zipHighlight = new L.GeoJSON();
                  zipHighlight.addData(zipsIndexed[e.data.zip]);
                  zipHighlight.setStyle(highlightStyle);
                  map.addLayer(zipHighlight);
                }
              }
            })
            .on('mouseout', function(e) {
              $('.tooltip').hide();
              map.removeLayer(zipHighlight);
            });
          
          // Lets lazily add zip highlighting.
          $('.loading-zips').appendTo($('#dd-map')).show();
          zips = function(data) {
            if (typeof data == 'string') {
              data = $.parseJSON(data);
            }
            
            // Index zips
            var i;
            for (i in data.features) {
              zipsIndexed[data.features[i].properties.zip] = data.features[i];
            }
            $('.loading-zips').hide();
          }
          $.ajax({
            type: 'GET',
            dataType: 'jsonp',
            url: 'https://s3.amazonaws.com/data.minnpost/geospatial-data/mn_zips.geojsonp?callback=zips',
            jsonp: 'callback'
          });
          
    		});
      })(jQuery);
    </script>
  </div>
  <!-- Embed End -->
  
  
</body>
</html>